# 브라우저의 ssl 인증서 동작원리

HTTP

hyper text transfer protocol의 약자로 인터넷 통신을 하기 위해 사용되는 프로토콜* 이다. 웹의 분야에선 클라이언트와 서버가 http를 이용하여 통신을 하게 된다. HTTP의 역할은 통신내용을 평문(문서)으로 전송하는 것인데 이때 보안의 문제가 생길 수 있다. 프로토콜로 정보를 전송하는 네트워크 중간에서 통신 내용을 가로챌 수 있다는 점이다.([세션 하이재킹](https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=tkdldjs35&logNo=100206748444)* 등) 이를 보완하기 위해 나온 암호화 방식의 프로토콜이 HTTPS이다.

프로토콜 : 컴퓨터간의 통신에 있어서 각자 다른 언어를 사용하면 통신이 되지 않기 때문에 공용으로 사용하는 언어

HTTPS

HTTPS는 HTTP에 Secure가 합쳐진 단어이다. HTTP와 동일한 통신 프로토콜이며 사용처도 똑같다. 이 프로토콜의 동작원리를 알아보자.

SSL

SSL또한 프로토콜 중 하나로 Secure Socket Layer의 약자이다. 인터넷 상의 데이터를 보호하기 위해 생긴 프로토콜인 SSL이지만, HTTPS와는 다른 프로토콜이다.

![출처 : [https://shlee0882.tistory.com/110](https://shlee0882.tistory.com/110) 
네트워크 7계층 동작원리 :[https://m.blog.naver.com/ster098/221999475002](https://m.blog.naver.com/ster098/221999475002) ](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a26cab37-6980-4980-8d58-16a0c3f9652b/Untitled.png)

출처 : [https://shlee0882.tistory.com/110](https://shlee0882.tistory.com/110)
네트워크 7계층 동작원리 :[https://m.blog.naver.com/ster098/221999475002](https://m.blog.naver.com/ster098/221999475002)

네트워크 7계층(OSI 7layer) 를 보면 7층의 응용계층과 4층의 통신계층 사이에 독립적인 프로토콜 계층을 만들어서 동작한다. HTTP는 응용계층이다. 때문에 HTTP나 SMTP같은 프로토콜이 SSL프로토콜 위에서 동작함으로 보안을 유지할 수 있다.

TLS

TLS는 SSL과 동일하며 이름만 다르다. 넷스케이프에서 SSL을 만들고 표준이 되면서 TSL이라는 이름으로 바뀌었지만 요즘은 그냥 둘다 쓴다. 하지만 기존에 쓰던 SSL이라는 이름이 더 널리 쓰인다.

SSL인증서

SSL인증서란 클라이언트와 서버간의 통신이 안전하다는 것을 보증해주는 문서이다. 클라이언트가 서버에 접속하게 되면, 서버는 클라이언트에세 인증서를 전달하여 신뢰를 얻게 된다. 인증서를 이용하면 다음과 같은 이점을 얻을 수 있다.

- 스니핑 방지
  - 로그인에 사용되는 아이디,비번 혹은 카드 정보 등등의 데이터가 암호화되어서 유출시 피해를 예방할 수있다.
- 피싱 방지
  - 유사 사이트를 이용한 사기로 사용자의 로그인을 유도하여 정보를 빼낸다. 이런 사이트는 SSL 인증서를 발급해주지 않는다.
- 데이터 변조 방지
  - 데이터 전송시에 외부에서 데이터에 접근하여 데이터를 변조하는 문제도 있으나 해결 가능

SSL 인증서 암호화 방식

- 대칭키
  암호화시에 key라는 비밀번호를 이용한다. 암호화 키는 복호화 키와 대칭이기 때문에 복호화 시에도 동일한 키를 사용해야한다. 하지만 이 경우 복호화 키를 전달하는 과정에서 키가 노출될 수 도 있다는 점에서 문제가 있다.
- 공개키
  공개키 암호화방식은 대칭키의 문제를 해결 할 수 있다. 두 개의 키를 사용하며, a키로 암호화시 b키로 복호화하는 방식이다. 이때 a키는 본인만이 가지고 있는 비공개키, b키는 타인에게 공개하는 공개키가 된다. 외부에서 공개키로 암호화된 데이터는 비공개키를 가지고 있는 본인뿐이기 때문에 암호화가 가능하며 키를 전달할 필요가 없기 때문에 대칭키의 문제를 해결 할 수 있다. 또한 비공개키로 암호화한 데이터를 공개키로 복호화가 가능하기 때문에 본인이 보낸 정보라는 것을 인증 받을 수 있다.

보안 동작 순서

SSL인증서의 동작은 크게 두 가지로 진행된다.

1. 클라이언트의 CA를 통해서 서버 인증서가 신뢰 가능한지
2. 보안 연결

인증 방식

세상에는 아무튼 신뢰가 가능한 기관이 몇 개 있다. 그 기관들은 최상위 인증 기관으로 불리고 Root CA라는 인증서를 발급해준다. 이 기관들은 본인들의 비밀키를 가지고 이에 대응하는 공개키를 세상에 뿌린다. 그리고 세상 사람들은 이 기관은 신용할 수 있음을 약속하고 배포된 공개키로 복호화가 가능한 데이터는 최상위 인증 기관의 암호키로 암호화 된 데이터이기 때문에 신뢰 가능하다고 간주한다.

이렇게 일반적으로 신뢰가 가능하다 여겨지는 기관의 공개키는 이미 웹브라우저에 내장되어 있다. 이는 OS업데이트를 통해서 업데이트가 되기도 하는데, 만약 정말 만약 OS가 옛날 버전이라 업데이트를 제공하지 않는 다면 공개키가 업데이트 되지 않거나 내장되어 있지 않게 됨으로 인증서가 제대로 되었다 해도 클라이언트가 보안 동작 순서의 1번을 제대로 인증 못해줌으로 인식이 안된다.

인증서 내용물

인증서에는 다양한 것이 들어있지만 대표적으로 다음과 같다.

1. 인증서 소유자명
2. 인증서 소유자 공개키
3. 인증서 유효기간
4. UID
5. 인증서 내용을 해시화해서 암호화한 값

인증서 계층

인증서는 계층구조로 되어 있고, 보통은 3계층이다. 최상위 계층은 Root인증서라고 하며 이 인증서는 최상위 인증 기관에서 발급한 인증서가 된다. 그 밑으로 중간 인증서 ssl인증서가 된다.

중간 인증서를 발급하고 싶은 회사는 최상위 인증 기관에게 본인의 인증서 내용을 해시하여 최상위 인증 기관의 비밀키로 암호화를 요청한다. 이렇게 되면 세상 사람들은 최상위 인증 기관의 공개키를 가지고 있고, 이 공개키로 복호화 되는 데이터는 신뢰 가능하다 인정함으로 중간 인증서 또한 신뢰 가능하다 할 수 있다고 간주하게 된다.

이를 Chain of Trust라고 한다. 상위 계층의 인증서가 신뢰 할 수 있다면 해당 인증서의 비밀키로 암호화된 하위 인증서도 신뢰를 가지게 된다. 그럼 인증서 내용을 해시화 한 후 다시 암호화 하는 이유는 무엇일까.

만약 공개키를 이용하여 중간 인증서의 해시된 값을 복호화 한후, 인증서 내부의 내용을 해쉬한 값을 비교 했을 때, 동일한 값이 아니라면 내용물이 변조되었음을 의미하게 된다.

즉 상위 인증서의 공개 키로 하위 인증서의 해시 값을 복호화 할 수 있음은 Chain of trust원리로 인증서의 신뢰를 얻을 수 있고, 하위 인증서의 내용물이 변조되었는지를 확인 할 수 있다.

이런 중간 인증서를 Root CA인증서와 구분지어서 ICA(intermediate CA)라 부른다. 이제 일반 사용자들은 이 ICA를 통해서 SSL인증서를 도입하게 된다. RCA에서 ICA가 그랬던 것 처럼 개인 인증서도 ICA의 비밀키로 암호화하게 되고 이는 ICA의 공개키로 복호화할 수 있게 된다.

참고

[https://m.blog.naver.com/alice_k106/221468341565](https://m.blog.naver.com/alice_k106/221468341565)

[https://offbyone.tistory.com/274](https://offbyone.tistory.com/274)

[https://brunch.co.kr/@sangjinkang/47](https://brunch.co.kr/@sangjinkang/47)
